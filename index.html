<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="styles/main.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <div class="navbar">
      <ul>
        <li><a href="#top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Home</a></li>
        <li><input type="button" value="Pause Scroll" id="scroll-btn"/></li>
      </ul>
    </div><div class="header"><h1>Twittler Feed</h1></div>
    <div class="container"></div>
    <script>

      $(document).ready(function(){
        var $container = $('.container');

        // sets up a twittler feed
        var tweetStream = function(userHome){
          $container.html('');
          var index = userHome.length - 1;

          while(index >= 0){
            var tweet = userHome[index];
            var $tweet = $('<div class="tweet"></div>');
            $tweet.html('<strong>@' + tweet.user + ' </strong>' 
                        + '<span>'+ tweet.created_at + '</span><br>'
                        + tweet.message);
            $tweet.appendTo($container);
            index -= 1;
          }
        };

        // runs twittler homepage
        var homePage = function(){
          tweetStream(streams.home)
        };

        // launch homepage
        homePage();
        
        // launch autoscroll event on home page
        var autoScroll = setInterval(homePage, 5000);
        
        // on/off switch for autoscroll event 
        $('#scroll-btn').click(function(event){
          if ($(this).prop('value') === 'Pause Scroll'){
            clearInterval(autoScroll);
            $(this).prop('value', ' Start Scroll');
          } else {
            $(this).prop('value', 'Pause Scroll');
            autoScroll = setInterval(homePage, 5000);
          }
        });

        // launch user feed on click
        $('.tweet').on('click', function(){
          var username = $(this).text();

          // regexp used to extract username string from clicked div
          username = /@\S*/.exec(username)[0].split('@')[1];

          clearInterval(autoScroll);
          $('h1').text(username + ' feed');
        
          tweetStream(streams.users[username]);
        });
      });

    // Next Steps:
    //// FIX BUG: cannot click tweets after initial homePage runthrough 
    //// ADD FEATURE: return to home        
    //// Turn timestamp into user friendly text

    </script>
  </body>
</html>